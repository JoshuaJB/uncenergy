<link rel="import" href="/components/paper-shadow/paper-shadow.html">

<polymer-element name="history-card">
  <template>
    <script type="text/javascript">
    function drawHistory() {
      if (!chartsReady || result == {} || !result['data'][energyType][historyType])
        return;
      var data = google.visualization.arrayToDataTable(generateHistory());
      var options = {
        vAxis: {title: result['data'][energyType]['live']['nativeUnit'], minValue: 0},
        legend: 'none'
      };
      document.querySelector("history-card").shadowRoot.getElementById("title").innerHTML = "Historical " + energyType.capitalize() + " Usage";
      var chart = new google.visualization.AreaChart(document.querySelector("history-card").shadowRoot.getElementById("history-chart"));
      chart.draw(data, options);
    }
    function historyTypeString() {
      switch (historyType)
      {
      case 'daily':
        return '24 Hours';
      case 'monthly':
        return '30 Days';
      case 'weekly':
        return '7 Days';
      case 'yearly':
        return '10 Years';
      }
    }
    function historyString(input) {
      switch (input)
      {
      case '24 Hours':
        return 'daily';
      case '30 Days':
        return 'monthly';
      case '7 Days':
        return 'weekly';
      case '10 Years':
        return 'yearly';
      }
    }
    function generateHistory() {
      var iterations = 0;
      var history = [];

      if (historyType == 'daily')
        iterations = 24;
      else if (historyType == 'weekly')
        iterations = 7;
      else if (historyType == 'monthly')
        iterations = 30;
      else if (historyType == 'yearly')
        iterations = 10;
      history.push(["", result['data'][energyType]['live']['nativeUnit']]);

      for (var i = 0; i < iterations; i++)
        history.push(['', Number(result['data'][energyType][historyType]['previous'][i]['amount'])]);

      return history;
    }
    </script>
    <style>
    :host {
      display: block;
      position: relative;
      background-color: white;
      padding: 20px;
      width: 100%;
      font-size: 1.2rem;
      font-weight: 300;
      margin-top: 20px;
    }
    .card-header {
      margin-bottom: 10px;
    }
    #history-chart {
      position:relative;
      width:400px;
      height:400px;
    }
    #title {
      margin-top: 20px;
      width: 100%;
      left: 0;
      color: black;
      font-size: 28px;
      text-align:center;
      position:absolute;
    }
    #historySel {
      position:absolute;
      left: 20px;
      right: 20px;
      top: 370px;
    }
    paper-dropdown-menu::shadow {
      position:absolute;
      left: 20px;
      right: 20px;
      top: 370px;
    }
    </style>
    <paper-shadow z="3"></paper-shadow>
    <div class="card-header" layout horizontal center>
      <div id="history-chart"></div>
      <p id="title"></p>
      <p id="building"></p>
      <paper-dropdown-menu id="historySel" selected="24 Hours" valueattr="label">
        <paper-item id="daily" label="24 Hours"></paper-item>
        <paper-item id="weekly" label="7 Days"></paper-item>
        <paper-item id="monthly" label="30 Days"></paper-item>
        <paper-item id="yearly" label="10 Years"></paper-item>
      </paper-dropdown-menu>
    </div>
    <script>
    var drops = document.querySelector("history-card").shadowRoot.querySelector('paper-dropdown-menu');
    drops.addEventListener('core-select', function() {
      historyType = historyString(this.selected);
      requestDocument();
    });
    </script>
  </template>
  <script>
  Polymer({});
  </script>
</polymer-element>
