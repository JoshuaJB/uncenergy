<link rel="import" href="/components/paper-shadow/paper-shadow.html">

<polymer-element name="history-card">
  <template>
    <script type="text/javascript">
    google.setOnLoadCallback(drawHistory);
    function drawHistory() {
      if (!result || !result['data'][energyType][historyType])
        return;
      var data = google.visualization.arrayToDataTable(generateHistory());
      var options = {
        hAxis: {title: historyTypeString(), titleTextStyle: {color: '#333'}},
        vAxis: {title: result['data'][energyType]['live']['nativeUnit'], minValue: 0},
        legend: 'none'
      };
      document.querySelector("history-card").shadowRoot.getElementById("title").innerHTML = "Historical " + energyType.capitalize() + " Usage";
      var chart = new google.visualization.AreaChart(document.querySelector("history-card").shadowRoot.getElementById("history-chart"));
      chart.draw(data, options);
    }
    function historyTypeString() {
      switch (historyType)
      {
      case 'daily':
        return 'One Day';
      case 'monthly':
        return 'One Month';
      case 'weekly':
        return 'One Week';
      case 'yearly':
        return 'One Year';
      }
    }
    function generateHistory() {
      var iterations = 0;
      var history = [];

      if (historyType == 'daily')
        iterations = 24;
      else if (historyType == 'weekly')
        iterations = 7;
      else if (historyType == 'monthly')
        iterations = 30;
      else if (historyType == 'yearly')
        iterations = 10;
      history.push(["", result['data'][energyType]['live']['nativeUnit']]);

      for (var i = 0; i < iterations; i++)
        history.push(['', Number(result['data'][energyType][historyType]['previous'][i]['amount'])]);

      return history;
    }
    </script>
    <style>
    :host {
      display: block;
      position: relative;
      background-color: white;
      padding: 20px;
      width: 100%;
      font-size: 1.2rem;
      font-weight: 300;
      margin-top: 20px;
    }
    .card-header {
      margin-bottom: 10px;
    }
    #history-chart {
      position:relative;
      width:400px;
      height:400px;
    }
    #title {
      margin-top: 20px;
      width: 100%;
      left: 0;
      color: black;
      font-size: 28px;
      text-align:center;
      position:absolute;
    }
    </style>
    <paper-shadow z="3"></paper-shadow>
    <div class="card-header" layout horizontal center>
      <div id="history-chart"></div>
      <p id="title"></p>
      <p id="building"></p>
    </div>
    
  </template>
  <script>
  Polymer({});
  </script>
</polymer-element>
