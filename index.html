<!doctype html>
<html>

<head>
	<title>UNC Energy Dashboard</title>

	<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
	<script src="/components/webcomponentsjs/webcomponents.js"></script>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>

	<link rel="import" href="/components/font-roboto/roboto.html">
	<link rel="import" href="/components/core-header-panel/core-header-panel.html">
	<link rel="import" href="/components/core-toolbar/core-toolbar.html">
	<link rel="import" href="/components/paper-tabs/paper-tabs.html">
	<link rel="import" href="/components/paper-elements/paper-elements.html">
	<link rel="import" href="/components/core-menu/core-menu.html">
	<link rel="import" href="/components/core-item/core-item.html">
	<link rel="import" href="/components/core-scaffold/core-scaffold.html">
	<link rel="import" href="/meter-card.html">
	<link rel="import" href="/history-card.html">
	<script>
		google.load('visualization', '1', {'packages':['corechart']});
		var chartsReady = false;
		var currentBuilding = '113';
		var httpRequest = new XMLHttpRequest();
		var energyType = 'electricity';
		var historyType = 'daily';
		var result = {};
		httpRequest.addEventListener("load", updatePage, false);
		httpRequest.addEventListener("error", loadError, false);
		document.addEventListener("DOMContentLoaded", requestDocument, false);
		google.setOnLoadCallback(function(){chartsReady = true});

		function updatePage() {
			// Make sure we only load an actual response
			if (httpRequest.responseText.indexOf("<") != -1) {
				loadError();
				return;
			}
			result = JSON.parse(httpRequest.responseText);
			drawChart();
			drawHistory();
			setTimeout(function(){requestDocument();}, 2000);
		}
		function loadError() {
			document.querySelector('#ajaxError').show();
		}
		function requestDocument() {
			httpRequest.open('GET', '/api.php?building=' + currentBuilding);
			httpRequest.send();
		}
		String.prototype.capitalize = function() {
			return this.charAt(0).toUpperCase() + this.slice(1);
		}
	</script>
	<style>
	html,body {
		height: 100%;
		margin: 0;
		background-color: #E5E5E5;
		font-family: 'RobotoDraft', sans-serif;
	}
	.container {
		width: 80%;
		margin: 50px auto;
	}
	@media (min-width: 481px) {
		#tabs {
			width: 200px;
		}
		.container {
			width: 400px;
		}
	}
	#tabs {
		width: 100%;
		margin: 0;
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
		text-transform: uppercase;
	}
	</style>
</head>

<body unresolved>
<core-scaffold>
	<core-header-panel navigation flex>
		<core-toolbar id="navheader" style="background-color: #56BA89;">
			<span>Buildings</span>
		</core-toolbar>
		<core-menu>
			<core-item id="104" label="Craige Res Hall"></core-item>
			<core-item id="113" label="Morrison Res Hall"></core-item>
			<core-item id="063" label="House Undergraduate Library"></core-item>
			<core-item id="065" label="Graham Student Union"></core-item>
			<core-item id="083" label="Sitterson Hall"></core-item>
			<core-item id="086" label="Caudill Labs"></core-item>
			<core-item id="093" label="Global Education Center"></core-item>
			<core-item id="152" label="Morehead Planetarium"></core-item>
			<core-item id="391" label="Rams Head Dining Hall"></core-item>
			<core-item id="745" label="Venable Hall"></core-item>
			<core-item id="027" label="Memorial Hall"></core-item>
		</core-menu>
	</core-header-panel>  
	<span tool>UNC Energy Dashboard</span>
	<div class="container" layout vertical center>
		<meter-card>
		</meter-card>
		<history-card>
		</history-card>
	</div>
	<paper-toast id="ajaxError" role="alert" text="There was an error getting data from the server.">
		<div style="color: #eeff41;" onclick="requestDocument()">Retry</div>
	</paper-toast>
	<script>
	var tabs = document.querySelector('core-menu');
	tabs.addEventListener('core-select', function() {
		currentBuilding = tabs.children[tabs.selected].id;
		requestDocument();
	});
</script>
</core-scaffold>
</body>

</html>
